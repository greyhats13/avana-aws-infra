[
  {
    "name" : "${unit}-${code}-${feature}-task-${env}",
    "image" : "${image}:latest",
    "cpu" : ${cpu},
    "memory" : ${memory},
    "memoryReservation" : ${memory_reservation},
    "essential" : true,
    "environment": [
      {
        "name": "DD_AGENT_HOST",
        "value": "${dd_service_discovery}.${dd_namespace}"
      },
      {
        "name": "DD_TRACE_AGENT_PORT",
        "value": "8126"
      },
      {
        "name": "DD_SERVICE",
        "value": "${unit}-${code}-${feature}"
      },
      {
        "name": "DD_ENV",
        "value": "${environment}"
      },
      {
        "name": "DD_DOCKER_LABELS_AS_TAGS",
        "value": "{\"com.docker.service_name\":\"${unit}-${code}-${feature}-${env}\"}"
      },
      {
        "name": "DD_TAGS",
        "value": "service:${unit}-${code}-${feature}-${env} host:%%host%% env:${environment} unit:${unit} code:${code} feature:${feature}"
      }
    ],
    "dockerLabels": {
      "com.datadoghq.ad.instances"    : "[{\"host\": \"%%host%%\", \"port\": ${port}}]",
      "com.datadoghq.ad.check_names"  : "[\"${unit}-${code}-${feature}-task-${env}\"]",
      "com.datadoghq.ad.init_configs" : "[{}]",
      "com.datadoghq.tags.service"    : "${unit}-${code}-${feature}-${env}",
      "com.datadoghq.tags.env"        : "${environment}",
      "com.datadoghq.ad.logs"         : "[{\"source\": \"${unit}-${code}-${feature}\", \"service\": \"${unit}-${code}-${feature}\"}]"
    },
    "mountPoints"  : [],
    "volumesFrom"  : [],
    "portMappings" : [
      {
        "containerPort" : ${port},
        "hostPort" : ${port},
        "protocol"  : "tcp"
      }
    ]
  }
]